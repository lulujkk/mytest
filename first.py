import streamlit as st
import pandas as pd
import numpy as np

# --------------------------
# é¡µé¢é…ç½®ï¼ˆè‡ªå®šä¹‰ç½‘å€ï¼šæ›¿æ¢ä¸ºå­¦ç”Ÿå§“åå…¨æ‹¼+3ï¼Œå¦‚luziguang3ï¼‰
# --------------------------
st.set_page_config(
    page_title="å—å®ç¾é£Ÿæ•°æ®ä»ªè¡¨ç›˜",
    page_icon="ğŸœ",
    layout="wide"
)

# --------------------------
# 1. æ•°æ®å‡†å¤‡
# --------------------------
# ï¼ˆ1ï¼‰åº—é“ºåŸºç¡€ä¿¡æ¯ï¼ˆ6å®¶åº—é“ºï¼Œæ»¡è¶³5+è¦æ±‚ï¼‰
shops_data = {
    "åº—é“ºåç§°": [
        "è€å‹ç²‰ä¸­å±±è·¯æ€»åº—",
        "å¤è®°è€å‹ç²‰ä¸ƒæ˜Ÿè·¯åº—",
        "èˆ’è®°è€å‹ç²‰æ¡ƒæºè·¯åº—",
        "å—é“èºè›³ç²‰æ€»åº—",
        "é‚•å·è€è¡—ç²‰é¥ºç‹",
        "ç”˜å®¶ç•Œç‰ŒæŸ æª¬é¸­æ€»åº—"
    ],
    "ç¾é£Ÿå“ç±»": ["è€å‹ç²‰", "è€å‹ç²‰", "è€å‹ç²‰", "èºè›³ç²‰", "ç²‰é¥º", "æŸ æª¬é¸­"],
    "è¯„åˆ†": [4.8, 4.7, 4.9, 4.6, 4.5, 4.8],
    "åœ°å€": [
        "å—å®å¸‚é’ç§€åŒºä¸­å±±è·¯66å·",
        "å—å®å¸‚é’ç§€åŒºä¸ƒæ˜Ÿè·¯89å·",
        "å—å®å¸‚é’ç§€åŒºæ¡ƒæºè·¯45å·",
        "å—å®å¸‚è¥¿ä¹¡å¡˜åŒºå—é“ä¸€è¡—23å·",
        "å—å®å¸‚æ±Ÿå—åŒºé‚•å·è€è¡—12å·",
        "å—å®å¸‚å…´å®åŒºé‚•æ­¦è·¯18å·"
    ],
    "çº¬åº¦": [22.8167, 22.8215, 22.8190, 22.8450, 22.7890, 22.8670],
    "ç»åº¦": [108.3220, 108.3280, 108.3180, 108.3020, 108.3450, 108.3350],
    "æœˆå‡æ¶ˆè´¹(å…ƒ)": [18, 16, 20, 15, 12, 68]
}
df_shops = pd.DataFrame(shops_data)

# ï¼ˆ2ï¼‰12ä¸ªæœˆä»·æ ¼èµ°åŠ¿æ•°æ®ï¼ˆ6å®¶åº—é“ºï¼Œæ»¡è¶³5+æŠ˜çº¿è¦æ±‚ï¼‰
months = ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ", "6æœˆ", "7æœˆ", "8æœˆ", "9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ"]
price_trend_data = {
    "æœˆä»½": months,
    "è€å‹ç²‰ä¸­å±±è·¯æ€»åº—": [18, 18, 18, 19, 19, 20, 20, 20, 19, 19, 18, 18],
    "å¤è®°è€å‹ç²‰ä¸ƒæ˜Ÿè·¯åº—": [16, 16, 15, 15, 16, 16, 16, 15, 15, 16, 16, 15],
    "èˆ’è®°è€å‹ç²‰æ¡ƒæºè·¯åº—": [20, 20, 21, 21, 22, 22, 22, 21, 21, 20, 20, 20],
    "å—é“èºè›³ç²‰æ€»åº—": [15, 15, 14, 14, 15, 15, 15, 14, 14, 15, 15, 14],
    "é‚•å·è€è¡—ç²‰é¥ºç‹": [12, 12, 12, 11, 11, 12, 12, 11, 11, 12, 12, 12],
    "ç”˜å®¶ç•Œç‰ŒæŸ æª¬é¸­æ€»åº—": [68, 68, 70, 70, 72, 72, 72, 70, 70, 68, 68, 68]
}
df_price_trend = pd.DataFrame(price_trend_data)

# ï¼ˆ3ï¼‰ç¾é£Ÿå“ç±»é”€é‡æ•°æ®
category_sales = {
    "ç¾é£Ÿå“ç±»": ["è€å‹ç²‰", "èºè›³ç²‰", "ç²‰é¥º", "æŸ æª¬é¸­", "å·ç­’ç²‰", "ç”Ÿæ¦¨ç²‰"],
    "æœˆé”€é‡(ä»½)": [12000, 9500, 4500, 6800, 5200, 7800]
}
df_category_sales = pd.DataFrame(category_sales)

# ï¼ˆ4ï¼‰ç”¨æˆ·è¯„ä»·åˆ†å¸ƒæ•°æ®ï¼ˆæŒ‰æœˆä»½ï¼‰
review_data = {
    "æœˆä»½": months,
    "å¥½è¯„æ•°": [850, 880, 920, 950, 980, 1020, 1050, 1080, 1100, 1050, 1000, 950],
    "ä¸­è¯„æ•°": [120, 110, 100, 90, 80, 70, 60, 70, 80, 90, 100, 110],
    "å·®è¯„æ•°": [30, 25, 20, 15, 10, 5, 5, 10, 15, 20, 25, 30]
}
df_review = pd.DataFrame(review_data)

# --------------------------
# 2. é¡µé¢æ ‡é¢˜ä¸ä¾§è¾¹æ 
# --------------------------
st.title("ğŸœ å—å®ç¾é£Ÿæ•°æ®ä»ªè¡¨ç›˜")
st.markdown("---")

# ä¾§è¾¹æ ç­›é€‰
st.sidebar.header("ç­›é€‰æ¡ä»¶")
selected_category = st.sidebar.multiselect(
    "é€‰æ‹©ç¾é£Ÿå“ç±»",
    options=df_shops["ç¾é£Ÿå“ç±»"].unique(),
    default=df_shops["ç¾é£Ÿå“ç±»"].unique()
)

# æ ¹æ®å“ç±»ç­›é€‰åº—é“ºæ•°æ®
df_shops_filtered = df_shops[df_shops["ç¾é£Ÿå“ç±»"].isin(selected_category)]

# --------------------------
# 3. ä¸»é¡µé¢å†…å®¹å¸ƒå±€
# --------------------------
# ç¬¬ä¸€è¡Œï¼šåº—é“ºä¿¡æ¯å±•ç¤º + ä»·æ ¼èµ°åŠ¿æŠ˜çº¿å›¾
col1, col2 = st.columns([1, 2])

with col1:
    st.subheader("å—å®çƒ­é—¨ç¾é£Ÿåº—é“ºä¿¡æ¯")
    st.dataframe(
        df_shops_filtered[["åº—é“ºåç§°", "ç¾é£Ÿå“ç±»", "è¯„åˆ†", "åœ°å€", "æœˆå‡æ¶ˆè´¹(å…ƒ)"]],
        use_container_width=True,
        hide_index=True
    )

with col2:
    st.subheader("6å®¶é¤å…12ä¸ªæœˆä»·æ ¼èµ°åŠ¿")
    st.line_chart(
        df_price_trend,
        x="æœˆä»½",
        y=df_price_trend.columns[1:],  # æ‰€æœ‰åº—é“ºçš„ä»·æ ¼åˆ—
        use_container_width=True,
        color=["#FF5733", "#33FF57", "#3357FF", "#FF33A6", "#A633FF", "#33FFF6"]
    )

st.markdown("---")

# ç¬¬äºŒè¡Œï¼šå“ç±»é”€é‡æŸ±çŠ¶å›¾ + ç”¨æˆ·è¯„ä»·é¢ç§¯å›¾
col3, col4 = st.columns(2)

with col3:
    st.subheader("å—å®ç¾é£Ÿå“ç±»æœˆé”€é‡")
    st.bar_chart(
        df_category_sales,
        x="ç¾é£Ÿå“ç±»",
        y="æœˆé”€é‡(ä»½)",
        use_container_width=True,
        color="#FF5733"
    )

with col4:
    st.subheader("ç”¨æˆ·è¯„ä»·åˆ†å¸ƒï¼ˆæŒ‰æœˆä»½ï¼‰")
    st.area_chart(
        df_review,
        x="æœˆä»½",
        y=["å¥½è¯„æ•°", "ä¸­è¯„æ•°", "å·®è¯„æ•°"],
        use_container_width=True,
        color=["#33FF57", "#FFD700", "#FF3333"]
    )

st.markdown("---")

# ç¬¬ä¸‰è¡Œï¼šåº—é“ºä½ç½®åœ°å›¾
st.subheader("å—å®ç¾é£Ÿåº—é“ºä½ç½®åˆ†å¸ƒ")
st.map(
    df_shops_filtered,
    latitude="çº¬åº¦",
    longitude="ç»åº¦",
    size=200,  # æ ‡è®°å¤§å°
    color="#FF5733"  # æ ‡è®°é¢œè‰²
)

# --------------------------
# 4. é¡µè„šä¿¡æ¯
# --------------------------
st.markdown("---")
st.markdown("### æ•°æ®è¯´æ˜ï¼šæœ¬ä»ªè¡¨ç›˜æ•°æ®ä¸ºå—å®æœ¬åœ°ç¾é£Ÿåº—é“ºæ¨¡æ‹Ÿæ•°æ®ï¼Œä»…ä¾›å±•ç¤ºä½¿ç”¨ã€‚")
